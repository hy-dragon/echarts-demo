<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>项目进度时间线</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      html,
      body {
        width: 100%;
        height: 100%;
        font-family: 'Microsoft YaHei', sans-serif;
      }
      #echart-container {
        width: 100%;
        height: 100%;
        background-color: #f5f5f5;
        position: relative;
      }
    </style>
    <script src="./js/echart.min.js"></script>
  </head>
  <body>
    <div id="echart-container"></div>
    <script>
      const container = document.getElementById('echart-container')
      const myChart = echarts.init(container)
      const projects = [
        {
          name: '智慧农业',
          status: 'green',
          description: '机器狗项目PR完成，商务合同签署中',
          nodes: [
            { date: '2025-01-11', description: '启动建设发布1' },
            { date: '2025-01-27', description: '工业拆建上线2' },
            { date: '2025-02-10', description: '收入增长上线3' },
            { date: '2025-02-27', description: '项目评审4' },
            { date: '2025-03-05', description: '技术验收5' },
            { date: '2025-03-22', description: '启动建设发布6' },
            { date: '2025-04-12', description: '启动建设发布7' },
            { date: '2025-04-28', description: '启动建设发布8' },
            { date: '2025-05-11', description: '启动建设发布9' },
            { date: '2025-05-18', description: '启动建设发布10' },
            { date: '2025-06-11', description: '启动建设发布11' },
            { date: '2025-06-21', description: '启动建设发布12' },
            { date: '2025-07-08', description: '启动建设发布13' },
            { date: '2025-07-18', description: '启动建设发布14' },
            { date: '2025-08-10', description: '启动建设发布15' },
            { date: '2025-09-22', description: '启动建设发布16' },
            { date: '2025-10-27', description: '启动建设发布17' },
            { date: '2025-11-20', description: '启动建设发布18' },
            { date: '2025-11-27', description: '启动建设发布19' },
            { date: '2025-12-20', description: '启动建设发布20' },
            { date: '2025-12-31', description: '启动建设发布21' }
          ]
        },
        {
          name: '数字政务',
          status: 'yellow',
          description: '系统集成测试进行中，预计下周完成',
          nodes: [
            { date: '2025-01-11', description: '启动建设发布1' },
            { date: '2025-01-27', description: '工业拆建上线2' },
            { date: '2025-02-10', description: '收入增长上线3' },
            { date: '2025-02-27', description: '项目评审4' },
            { date: '2025-03-05', description: '技术验收5' },
            { date: '2025-03-22', description: '启动建设发布6' },
            { date: '2025-04-12', description: '启动建设发布7' },
            { date: '2025-04-28', description: '启动建设发布8' },
            { date: '2025-05-11', description: '启动建设发布9' },
            { date: '2025-05-18', description: '启动建设发布10' },
            { date: '2025-06-11', description: '启动建设发布11' },
            { date: '2025-06-21', description: '启动建设发布12' },
            { date: '2025-07-08', description: '启动建设发布13' },
            { date: '2025-07-18', description: '启动建设发布14' },
            { date: '2025-08-10', description: '启动建设发布15' },
            { date: '2025-09-22', description: '启动建设发布16' },
            { date: '2025-10-27', description: '启动建设发布17' },
            { date: '2025-11-20', description: '启动建设发布18' },
            { date: '2025-11-27', description: '启动建设发布19' },
            { date: '2025-12-20', description: '启动建设发布20' },
            { date: '2025-12-31', description: '启动建设发布21' }
          ]
        },
        {
          name: '智慧交通',
          status: 'red',
          description: '设备采购延期，需要重新调整计划',
          nodes: [
            { date: '2025-01-11', description: '启动建设发布1' },
            { date: '2025-01-27', description: '工业拆建上线2' },
            { date: '2025-02-10', description: '收入增长上线3' },
            { date: '2025-02-27', description: '项目评审4' },
            { date: '2025-03-05', description: '技术验收5' },
            { date: '2025-03-22', description: '启动建设发布6' },
            { date: '2025-04-12', description: '启动建设发布7' },
            { date: '2025-04-28', description: '启动建设发布8' },
            { date: '2025-05-11', description: '启动建设发布9' },
            { date: '2025-05-18', description: '启动建设发布10' },
            { date: '2025-06-11', description: '启动建设发布11' },
            { date: '2025-06-21', description: '启动建设发布12' },
            { date: '2025-07-08', description: '启动建设发布13' },
            { date: '2025-07-18', description: '启动建设发布14' },
            { date: '2025-08-10', description: '启动建设发布15' },
            { date: '2025-09-22', description: '启动建设发布16' },
            { date: '2025-10-27', description: '启动建设发布17' },
            { date: '2025-11-20', description: '启动建设发布18' },
            { date: '2025-11-27', description: '启动建设发布19' },
            { date: '2025-12-20', description: '启动建设发布20' },
            { date: '2025-12-31', description: '启动建设发布21' }
          ]
        }
      ]

      // 当前日期时间点
      const currentDate = new Date(2025, 7, 31) // 2025年8月31日
      const statusColors = { green: '#52c41a', yellow: '#faad14', red: '#f5222d' }

      // 创建时间轴（1月到12月）
      const timeAxis = []
      for (let i = 1; i <= 12; i++) {
        timeAxis.push(`2025-${String(i).padStart(2, '0')}-01`)
      }

      // 创建系列数据
      const series = []

      // 为每个项目创建时间线和节点
      projects.forEach((project, projectIndex) => {
        const projectY = projectIndex

        // 创建项目时间线
        series.push({
          name: `${project.name}-时间线`,
          type: 'line',
          coordinateSystem: 'cartesian2d',
          data: [
            [timeAxis[0], projectY],
            [timeAxis[11], projectY]
          ],
          lineStyle: {
            color: '#ddd',
            width: 2,
            type: 'solid'
          },
          symbol: 'none',
          z: 1
        })

        // 创建已完成的节点（当前时间之前）
        const completedNodes = project.nodes.filter(node => new Date(node.date) <= currentDate)
        series.push({
          name: `${project.name}-已完成节点`,
          type: 'scatter',
          coordinateSystem: 'cartesian2d',
          data: completedNodes.map(node => [node.date, projectY]),
          symbolSize: 10,
          itemStyle: {
            color: '#52c41a',
            borderColor: '#52c41a',
            borderWidth: 2
          },
          z: 3,
          label: {
            show: true,
            position: 'top',
            formatter: params => {
              const nodeIndex = completedNodes.findIndex(node => node.date === params.value[0])
              return completedNodes[nodeIndex].description
            },
            fontSize: 10,
            color: '#333'
          }
        })

        // 创建未完成的节点（当前时间之后）
        const pendingNodes = project.nodes.filter(node => new Date(node.date) > currentDate)
        series.push({
          name: `${project.name}-未完成节点`,
          type: 'scatter',
          coordinateSystem: 'cartesian2d',
          data: pendingNodes.map(node => [node.date, projectY]),
          symbolSize: 10,
          itemStyle: {
            color: '#fff',
            borderColor: '#ddd',
            borderWidth: 2
          },
          z: 3,
          label: {
            show: true,
            position: 'top',
            formatter: params => {
              const nodeIndex = pendingNodes.findIndex(node => node.date === params.value[0])
              return pendingNodes[nodeIndex].description
            },
            fontSize: 10,
            color: '#666'
          }
        })
      })

      // 计算图表区域的精确位置
      const gridLeft = 250
      const gridRight = 50
      const chartWidth = container.offsetWidth - gridLeft - gridRight
      const labelWidth = 70
      // 添加当前时间线
      series.push({
        name: '当前时间线',
        type: 'line',
        coordinateSystem: 'cartesian2d',
        data: [
          [currentDate.toISOString().split('T')[0], -0.5],
          [currentDate.toISOString().split('T')[0], projects.length - 0.5]
        ],
        lineStyle: {
          color: '#f5222d',
          width: 3,
          type: 'dashed'
        },
        symbol: 'none',
        z: 2,
        markLine: {
          silent: true,
          lineStyle: {
            color: '#f5222d',
            type: 'dashed',
            width: 3
          },
          data: [
            {
              xAxis: currentDate.toISOString().split('T')[0]
            }
          ]
        }
      })

      // 创建月份标签的graphic元素
      const monthLabels = []
      for (let i = 1; i <= 12; i++) {
        const leftPosition = gridLeft + (chartWidth / 12) * (i - 0.5) - labelWidth / 2

        monthLabels.push({
          type: 'rect',
          left: leftPosition,
          bottom: 30,
          shape: {
            width: labelWidth,
            height: 25
          },
          style: {
            fill: '#d5d1e4',
            stroke: 'none',
            borderRadius: 5
          }
        })

        monthLabels.push({
          type: 'text',
          left: leftPosition + labelWidth / 2,
          bottom: 42.5,
          style: {
            text: `${i}月`,
            textAlign: 'center',
            textVerticalAlign: 'middle',
            fontSize: 12,
            fontWeight: 'bold',
            color: '#333'
          }
        })
      }

      const option = {
        title: {
          text: '项目进度时间线',
          left: 'center',
          top: 20,
          textStyle: {
            color: '#333',
            fontSize: 18,
            fontWeight: 'bold'
          }
        },
        grid: {
          left: gridLeft,
          right: gridRight,
          top: 120,
          bottom: 80,
          height: 400
        },
        xAxis: {
          type: 'time',
          min: '2025-01-01',
          max: '2025-12-31',
          axisLabel: {
            show: false // 隐藏默认标签，使用自定义标签
          },
          axisTick: {
            show: false
          },
          axisLine: {
            lineStyle: {
              color: '#ddd'
            }
          },
          splitLine: {
            show: true,
            interval: (index, value) => {
              // 只在月份边界显示分割线
              const date = new Date(value)
              return date.getDate() === 1
            },
            lineStyle: {
              color: '#eee',
              type: 'solid'
            }
          }
        },
        yAxis: {
          type: 'value',
          min: -0.5,
          max: projects.length - 0.5,
          interval: 1, // 确保每个项目有足够空间
          axisLabel: {
            show: false
          },
          axisTick: {
            show: false
          },
          axisLine: {
            show: false
          },
          splitLine: {
            show: false
          }
        },
        series: series,
        graphic: [
          // 项目卡片
          ...projects.map((project, index) => ({
            type: 'group',
            left: 20,
            top: 120 + (index * 140),
            children: [
              {
                type: 'rect',
                shape: {
                  width: 220,
                  height: 80
                },
                style: {
                  fill: '#fff',
                  stroke: '#ddd',
                  lineWidth: 1,
                  shadowColor: 'rgba(0,0,0,0.1)',
                  shadowBlur: 4,
                  shadowOffsetY: 2
                }
              },
              {
                type: 'text',
                style: {
                  text: project.name,
                  x: 15,
                  y: 25,
                  font: 'bold 16px Microsoft YaHei',
                  fill: '#333'
                }
              },
              {
                type: 'text',
                style: {
                  text: project.description,
                  x: 15,
                  y: 45,
                  font: '12px Microsoft YaHei',
                  fill: '#666'
                }
              },
              {
                type: 'circle',
                shape: {
                  cx: 195,
                  cy: 20,
                  r: 8
                },
                style: {
                  fill: statusColors[project.status],
                  stroke: '#fff',
                  lineWidth: 2
                }
              }
            ]
          })),
          // 月份标签
          ...monthLabels
        ],
        tooltip: {
          trigger: 'item',
          formatter: params => {
            if (params.seriesName.includes('节点')) {
              const projectName = params.seriesName.split('-')[0]
              const project = projects.find(p => p.name === projectName)
              const node = project.nodes.find(n => n.date === params.value[0])
              return `${projectName}<br/>${node.description}<br/>${node.date}`
            }
            return params.seriesName
          }
        }
      }

      myChart.setOption(option)

      // 重要：窗口大小改变时重新计算标签位置
      window.addEventListener('resize', () => {
        myChart.resize()
        // 重新计算并更新月份标签位置
        setTimeout(() => {
          const newChartWidth = container.offsetWidth - gridLeft - gridRight
          const newMonthLabels = []
          
          for (let i = 1; i <= 12; i++) {
            const leftPosition = gridLeft + (newChartWidth / 12) * (i - 0.5) - labelWidth / 2
            
            newMonthLabels.push({
              type: 'rect',
              left: leftPosition,
              bottom: 30,
              shape: {
                width: labelWidth,
                height: 25
              },
              style: {
                fill: '#d5d1e4',
                stroke: 'none',
                borderRadius: 5
              }
            })
            
            newMonthLabels.push({
              type: 'text',
              left: leftPosition + labelWidth / 2,
              bottom: 42.5,
              style: {
                text: `${i}月`,
                textAlign: 'center',
                textVerticalAlign: 'middle',
                fontSize: 12,
                fontWeight: 'bold',
                color: '#333'
              }
            })
          }
          
          // 更新graphic配置
          const newOption = myChart.getOption()
          newOption.graphic = [
            ...newOption.graphic.slice(0, projects.length),  // 保留项目卡片
            ...newMonthLabels  // 更新月份标签
          ]
          myChart.setOption(newOption)
        }, 100)
      })
    </script>
  </body>
</html>
