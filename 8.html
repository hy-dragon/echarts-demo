<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>é¡¹ç›®è¿›åº¦æ—¶é—´çº¿</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      html,
      body {
        width: 100%;
        height: 100%;
        font-family: 'Microsoft YaHei', sans-serif;
      }
      #echart-container {
        width: 100%;
        height: 100%;
        background-color: #f5f5f5;
        position: relative;
      }
    </style>
    <script src="./js/echart.min.js"></script>
  </head>
  <body>
    <div id="echart-container"></div>
    <script>
      const container = document.getElementById('echart-container')
      const myChart = echarts.init(container)
      const projects = [
        {
          name: 'æ™ºæ…§å†œä¸š',
          status: 'green',
          description: 'æœºå™¨ç‹—é¡¹ç›®PRå®Œæˆï¼Œå•†åŠ¡åˆåŒç­¾ç½²ä¸­',
          nodes: [
            { date: '2025-01-11', description: 'å¯åŠ¨å»ºè®¾å‘å¸ƒ1' },
            { date: '2025-01-27', description: 'å·¥ä¸šæ‹†å»ºä¸Šçº¿2' },
            { date: '2025-02-10', description: 'æ”¶å…¥å¢é•¿ä¸Šçº¿3' },
            { date: '2025-02-27', description: 'é¡¹ç›®è¯„å®¡4' },
            { date: '2025-03-05', description: 'æŠ€æœ¯éªŒæ”¶5' },
            { date: '2025-03-22', description: 'å¯åŠ¨å»ºè®¾å‘å¸ƒ6' },
            { date: '2025-04-12', description: 'å¯åŠ¨å»ºè®¾å‘å¸ƒ7' },
            { date: '2025-04-28', description: 'å¯åŠ¨å»ºè®¾å‘å¸ƒ8' },
            { date: '2025-05-11', description: 'å¯åŠ¨å»ºè®¾å‘å¸ƒ9' },
            { date: '2025-05-18', description: 'å¯åŠ¨å»ºè®¾å‘å¸ƒ10' },
            { date: '2025-06-11', description: 'å¯åŠ¨å»ºè®¾å‘å¸ƒ11' },
            { date: '2025-06-21', description: 'å¯åŠ¨å»ºè®¾å‘å¸ƒ12' },
            { date: '2025-07-08', description: 'å¯åŠ¨å»ºè®¾å‘å¸ƒ13' },
            { date: '2025-07-18', description: 'å¯åŠ¨å»ºè®¾å‘å¸ƒ14' },
            { date: '2025-08-10', description: 'å¯åŠ¨å»ºè®¾å‘å¸ƒ15' },
            { date: '2025-09-22', description: 'å¯åŠ¨å»ºè®¾å‘å¸ƒ16' },
            { date: '2025-10-27', description: 'å¯åŠ¨å»ºè®¾å‘å¸ƒ17' },
            { date: '2025-11-20', description: 'å¯åŠ¨å»ºè®¾å‘å¸ƒ18' },
            { date: '2025-11-27', description: 'å¯åŠ¨å»ºè®¾å‘å¸ƒ19' },
            { date: '2025-12-20', description: 'å¯åŠ¨å»ºè®¾å‘å¸ƒ20' },
            { date: '2025-12-31', description: 'å¯åŠ¨å»ºè®¾å‘å¸ƒ21' }
          ]
        },
        {
          name: 'æ•°å­—æ”¿åŠ¡',
          status: 'yellow',
          description: 'ç³»ç»Ÿé›†æˆæµ‹è¯•è¿›è¡Œä¸­ï¼Œé¢„è®¡ä¸‹å‘¨å®Œæˆ',
          nodes: [
            { date: '2025-01-11', description: 'å¯åŠ¨å»ºè®¾å‘å¸ƒ1' },
            { date: '2025-01-27', description: 'å·¥ä¸šæ‹†å»ºä¸Šçº¿2' },
            { date: '2025-02-10', description: 'æ”¶å…¥å¢é•¿ä¸Šçº¿3' },
            { date: '2025-02-27', description: 'é¡¹ç›®è¯„å®¡4' },
            { date: '2025-03-05', description: 'æŠ€æœ¯éªŒæ”¶5' },
            { date: '2025-03-22', description: 'å¯åŠ¨å»ºè®¾å‘å¸ƒ6' },
            { date: '2025-04-12', description: 'å¯åŠ¨å»ºè®¾å‘å¸ƒ7' },
            { date: '2025-04-28', description: 'å¯åŠ¨å»ºè®¾å‘å¸ƒ8' },
            { date: '2025-05-11', description: 'å¯åŠ¨å»ºè®¾å‘å¸ƒ9' },
            { date: '2025-05-18', description: 'å¯åŠ¨å»ºè®¾å‘å¸ƒ10' },
            { date: '2025-06-11', description: 'å¯åŠ¨å»ºè®¾å‘å¸ƒ11' },
            { date: '2025-06-21', description: 'å¯åŠ¨å»ºè®¾å‘å¸ƒ12' },
            { date: '2025-07-08', description: 'å¯åŠ¨å»ºè®¾å‘å¸ƒ13' },
            { date: '2025-07-18', description: 'å¯åŠ¨å»ºè®¾å‘å¸ƒ14' },
            { date: '2025-08-10', description: 'å¯åŠ¨å»ºè®¾å‘å¸ƒ15' },
            { date: '2025-09-22', description: 'å¯åŠ¨å»ºè®¾å‘å¸ƒ16' },
            { date: '2025-10-27', description: 'å¯åŠ¨å»ºè®¾å‘å¸ƒ17' },
            { date: '2025-11-20', description: 'å¯åŠ¨å»ºè®¾å‘å¸ƒ18' },
            { date: '2025-11-27', description: 'å¯åŠ¨å»ºè®¾å‘å¸ƒ19' },
            { date: '2025-12-20', description: 'å¯åŠ¨å»ºè®¾å‘å¸ƒ20' },
            { date: '2025-12-31', description: 'å¯åŠ¨å»ºè®¾å‘å¸ƒ21' }
          ]
        },
        {
          name: 'æ™ºæ…§äº¤é€š',
          status: 'red',
          description: 'è®¾å¤‡é‡‡è´­å»¶æœŸï¼Œéœ€è¦é‡æ–°è°ƒæ•´è®¡åˆ’',
          nodes: [
            { date: '2025-01-11', description: 'å¯åŠ¨å»ºè®¾å‘å¸ƒ1' },
            { date: '2025-01-27', description: 'å·¥ä¸šæ‹†å»ºä¸Šçº¿2' },
            { date: '2025-02-10', description: 'æ”¶å…¥å¢é•¿ä¸Šçº¿3' },
            { date: '2025-02-27', description: 'é¡¹ç›®è¯„å®¡4' },
            { date: '2025-03-05', description: 'æŠ€æœ¯éªŒæ”¶5' },
            { date: '2025-03-22', description: 'å¯åŠ¨å»ºè®¾å‘å¸ƒ6' },
            { date: '2025-04-12', description: 'å¯åŠ¨å»ºè®¾å‘å¸ƒ7' },
            { date: '2025-04-28', description: 'å¯åŠ¨å»ºè®¾å‘å¸ƒ8' },
            { date: '2025-05-11', description: 'å¯åŠ¨å»ºè®¾å‘å¸ƒ9' },
            { date: '2025-05-18', description: 'å¯åŠ¨å»ºè®¾å‘å¸ƒ10' },
            { date: '2025-06-11', description: 'å¯åŠ¨å»ºè®¾å‘å¸ƒ11' },
            { date: '2025-06-21', description: 'å¯åŠ¨å»ºè®¾å‘å¸ƒ12' },
            { date: '2025-07-08', description: 'å¯åŠ¨å»ºè®¾å‘å¸ƒ13' },
            { date: '2025-07-18', description: 'å¯åŠ¨å»ºè®¾å‘å¸ƒ14' },
            { date: '2025-08-10', description: 'å¯åŠ¨å»ºè®¾å‘å¸ƒ15' },
            { date: '2025-09-22', description: 'å¯åŠ¨å»ºè®¾å‘å¸ƒ16' },
            { date: '2025-10-27', description: 'å¯åŠ¨å»ºè®¾å‘å¸ƒ17' },
            { date: '2025-11-20', description: 'å¯åŠ¨å»ºè®¾å‘å¸ƒ18' },
            { date: '2025-11-27', description: 'å¯åŠ¨å»ºè®¾å‘å¸ƒ19' },
            { date: '2025-12-20', description: 'å¯åŠ¨å»ºè®¾å‘å¸ƒ20' },
            { date: '2025-12-31', description: 'å¯åŠ¨å»ºè®¾å‘å¸ƒ21' }
          ]
        }
      ]

      const statusColors = { green: '#52c41a', yellow: '#faad14', red: '#f5222d' }

      const currentDate = new Date().getTime()

      // 12 ä¸ªæœˆä»½çš„é‡ç‚¹æ—¥æœŸ
      // ç”Ÿæˆæ¯ä¸ªæœˆçš„ç¬¬ä¸€å¤©æ—¶é—´æˆ³
      const year = new Date().getFullYear()
      const monthTimestamps = []
      for (let m = 0; m <= 12; m++) {
        monthTimestamps.push(new Date(year, m, 1).getTime())
        // monthTimestamps.push(echarts.time.format(new Date(year, m, 1).getTime(), '{yyyy}-{MM}-{dd}'))
      }
      // è®¡ç®—â€œåŒºé—´ä¸­ç‚¹â€æ—¶é—´ï¼ˆ1æœˆåˆ°2æœˆã€2æœˆåˆ°3æœˆâ€¦â€¦ï¼‰
      const midMonthDates = []
      for (let i = 0; i < monthTimestamps.length - 1; i++) {
        const mid = (monthTimestamps[i] + monthTimestamps[i + 1]) / 2
        const date = echarts.time.format(mid, '{yyyy}-{MM}-{dd}')
        midMonthDates.push(date)
      }

      let monthLabelData = []
      monthLabelData = midMonthDates.map((item, index) => {
        const startDate = echarts.time.format(monthTimestamps[index], '{yyyy}-{MM}-{dd}')
        const endDate = echarts.time.format(monthTimestamps[index + 1], '{yyyy}-{MM}-{dd}')
        return {
          value: [item, 0, startDate, endDate, index + 1]
        }
      })
      console.log(`ğŸš€ ~ monthLabelData:`, monthLabelData)

      // è‡ªå®šä¹‰æœˆä»½æ ‡ç­¾
      // ç±»ä¼¼ 1-2 -> 1æœˆ 2-3 -> 2æœˆ ä¾æ¬¡ç±»æ¨çš„æ•ˆæœ
      const monthLabelSeries = {
        name: 'monthLabels',
        type: 'custom',
        coordinateSystem: 'cartesian2d',
        // ä¿®æ­£æ•°æ®æ ¼å¼ï¼šç¡®ä¿æ¯ä¸ªæ•°æ®é¡¹éƒ½æœ‰æ­£ç¡®çš„ç»“æ„
        data: monthLabelData,
        renderItem: function (params, api) {
          const dateValue = api.value(0)
          const month = api.value(4)
          const startDate = api.value(2)
          const endDate = api.value(3)
          const centerPoint = api.coord([dateValue, 0])
          const startPixel = api.coord([startDate, 0])
          const endPixel = api.coord([endDate, 0])

          const fullWidth = Math.abs(endPixel[0] - startPixel[0]) * 0.9
          // èƒŒæ™¯å®½åº¦ä¸º0.9å€ï¼Œç•™å‡ºé—´è·
          const backgroundWidth = fullWidth * 0.9

          // è®¡ç®—èƒŒæ™¯çŸ©å½¢çš„èµ·å§‹ä½ç½®ï¼ˆå±…ä¸­æ˜¾ç¤ºï¼‰
          const backgroundX = centerPoint[0] - backgroundWidth / 2
          const backgroundY = centerPoint[1] - 35 // å‘ä¸Šåç§»35åƒç´ 

          return {
            type: 'group',
            children: [
              // èƒŒæ™¯çŸ©å½¢
              {
                type: 'rect',
                x: backgroundX,
                y: backgroundY,
                shape: {
                  width: backgroundWidth,
                  height: 25,
                  r: [5]
                },
                style: {
                  fill: '#E6A7F8'
                }
              },
              // æ–‡æœ¬æ ‡ç­¾
              {
                type: 'text',
                x: centerPoint[0],
                y: backgroundY + 12.5,
                style: {
                  text: `${month}æœˆ`,
                  fontSize: 13,
                  fontWeight: 'bold',
                  fill: '#000',
                  align: 'center',
                  verticalAlign: 'middle'
                }
              }
            ]
          }
        },
        silent: true,
        z: 10
      }

      // æœ€åä¸€æ¡è®¡åˆ’çº¿ ä¸ç”¨æ˜¾ç¤ºå‡ºæ¥ç”¨æ¥æ˜¾ç¤ºä¸€ä¸ªç©ºä½
      // ç”¨äºä¿æŒè®¡åˆ’çº¿ç¬¬ä¸€æ¡å’Œæœ€åä¸€æ¡éƒ½æœ‰ç©ºè¡Œ
      const lastProject = {
        name: `æœ€åä¸€æ¡è®¡åˆ’çº¿`,
        type: 'line',
        coordinateSystem: 'cartesian2d',
        // data: project.nodes.map(item => [item.date, projectY]),
        data: [
          ['2025-01-01', projects.length + 1],
          ['2025-12-31', projects.length + 1]
        ],
        lineStyle: {
          color: '#000000',
          width: 0,
          type: 'solid'
        },
        hoverAnimation: false,
        symbol: 'none',
        z: 1
      }
      // åˆ›å»ºç³»åˆ—æ•°æ®
      const series = [monthLabelSeries]

      // ä¸ºæ¯ä¸ªé¡¹ç›®åˆ›å»ºè®¡åˆ’è¿›åº¦çº¿å’ŒèŠ‚ç‚¹
      projects.forEach((project, projectIndex) => {
        const projectY = projectIndex + 1

        const projectLine = {
          name: `${project.name}-è®¡åˆ’çº¿`,
          type: 'line',
          coordinateSystem: 'cartesian2d',
          // data: project.nodes.map(item => [item.date, projectY]),
          data: [
            ['2025-01-01', projectY],
            ['2025-12-31', projectY]
          ],
          lineStyle: {
            color: '#000000',
            width: 2,
            type: 'solid'
          },
          hoverAnimation: false,
          symbol: 'none',
          z: 1
        }

        // åˆ›å»ºé¡¹ç›®è®¡åˆ’çº¿
        series.push(projectLine)

        // é¡¹ç›®è®¡åˆ’å·²å®ŒæˆèŠ‚ç‚¹
        const completedNodes = project.nodes.filter(node => new Date(node.date) <= currentDate)
        const completedNodeSeries = {
          name: `${project.name}-å·²å®ŒæˆèŠ‚ç‚¹`,
          type: 'scatter',
          coordinateSystem: 'cartesian2d',
          data: completedNodes.map(node => [node.date, projectY]),
          symbol: 'circle',
          symbolSize: 20,
          itemStyle: {
            color: '#C3ECB2',
            borderColor: '#000',
            borderWidth: 1
          },
          animation: false,
          emphasis: {
            scale: false
          },
          label: {
            show: true,
            position: 'top',
            formatter: params => {
              const nodeIndex = completedNodes.findIndex(node => node.date === params.value[0])
              return completedNodes[nodeIndex].description
            },
            width: 60,
            overflow: 'break',
            fontSize: 10,
            color: '#666'
          },
          z: 3
        }
        series.push(completedNodeSeries)

        // é¡¹ç›®è®¡åˆ’æœªå¼€å§‹çš„èŠ‚ç‚¹
        const pendingNodes = project.nodes.filter(node => new Date(node.date) > currentDate)
        const pendingNodeSeries = {
          name: `${project.name}-æœªå®ŒæˆèŠ‚ç‚¹`,
          type: 'scatter',
          coordinateSystem: 'cartesian2d',
          data: pendingNodes.map(node => [node.date, projectY]),
          symbolSize: 20,
          itemStyle: {
            color: '#fff',
            borderColor: '#000',
            borderWidth: 1
          },
          z: 3,
          label: {
            show: true,
            position: 'top',
            formatter: params => {
              const nodeIndex = pendingNodes.findIndex(node => node.date === params.value[0])
              return pendingNodes[nodeIndex].description
            },
            fontSize: 10,
            color: '#666'
          }
        }
        series.push(pendingNodeSeries)

        // è‡ªå®šä¹‰å½“å‰æ—¶é—´çº¿
        const currentTimeSeries = {
          name: 'å½“å‰æ—¶é—´çº¿',
          type: 'custom',
          coordinateSystem: 'cartesian2d',
          data: [[echarts.time.format(currentDate, '{yyyy}-{MM}-{dd}'), 0]],
          renderItem: function (params, api) {
            const currentTimeValue = api.value(0)

            // è®¡ç®—èµ·å§‹å’Œç»“æŸçš„ y åæ ‡ï¼ˆç¨å¾®è¶…å‡ºèŒƒå›´ï¼‰
            const startY = -0.25 // è¶…å‡º0åˆ»åº¦ä¸€ç‚¹ç‚¹
            const endY = projects.length + 0.25 // è¶…å‡ºé¡¹ç›®æ•°é‡ä¸€ç‚¹ç‚¹

            // è½¬æ¢ä¸ºåƒç´ åæ ‡
            const startPoint = api.coord([currentTimeValue, startY])
            console.log(`ğŸš€ ~ startPoint:`, startPoint)
            const endPoint = api.coord([currentTimeValue, endY])
            console.log(`ğŸš€ ~ endPoint:`, endPoint)

            if (!startPoint || !endPoint) {
              return null
            }

            return {
              type: 'group',
              children: [
                // è™šçº¿
                {
                  type: 'line',
                  shape: {
                    x1: startPoint[0],
                    y1: startPoint[1], // ä½¿ç”¨è½¬æ¢åçš„åƒç´ åæ ‡
                    x2: endPoint[0],
                    y2: endPoint[1] // ä½¿ç”¨è½¬æ¢åçš„åƒç´ åæ ‡
                  },
                  style: {
                    stroke: '#FF0000',
                    lineWidth: 1,
                    lineDash: [5, 5] // è™šçº¿æ ·å¼ [å®çº¿é•¿åº¦, ç©ºéš™é•¿åº¦]
                  }
                },
                // çº¢æ—— Emoji
                {
                  type: 'text',
                  position: [startPoint[0] - 20, startPoint[1] - 40],
                  style: {
                    text: 'ğŸš©',
                    fontSize: 16,
                    align: 'center'
                  }
                },
                // æ ‡ç­¾
                {
                  type: 'text',
                  position: [startPoint[0], startPoint[1] - 20],
                  style: {
                    text: 'å½“å‰',
                    fill: '#FF0000',
                    fontSize: 12,
                    fontWeight: 'bold',
                    align: 'center'
                  }
                }
              ]
            }
          },
          silent: true,
          z: 5
        }
        series.push(currentTimeSeries)
      })

      let statusData = []
      statusData = projects.map((project, projectIndex) => [
        0,
        projectIndex + 1,
        project.name,
        project.status,
        project.description
      ])
      console.log(`ğŸš€ ~ statusData:`, statusData)
      // y è½´æ˜¾ç¤ºçš„é¡¹ç›®çŠ¶æ€å¡ç‰‡
      const projectStatusCardSeries = {
        name: 'é¡¹ç›®çŠ¶æ€å¡ç‰‡',
        type: 'custom',
        data: statusData,
        renderItem: function (params, api) {
          const yIdx = api.value(1)
          const projectName = api.value(2)
          const statusColor = api.value(3)
          const description = api.value(4)

          const yCoord = api.coord([0, yIdx])[1]

          const cardX = 20
          const cardW = 180
          const cardH = 36
          const cardY = yCoord - cardH / 2
          const gapRate = 0.05 // æè¿°æ–‡å­—ä¸å¡ç‰‡å³è¾¹è·ç¦»ä¸ºå¡ç‰‡å®½åº¦çš„8%
          const gap = cardW * gapRate
          const descX = cardX + cardW + gap
          const maxDescWidth = 100 // æœ€å¤§æè¿°æ–‡å­—å®½åº¦ï¼Œè¶…å‡ºè‡ªåŠ¨æ¢è¡Œ

          return {
            type: 'group',
            children: [
              {
                type: 'rect',
                x: cardX,
                y: cardY,
                shape: { width: cardW, height: cardH, r: 6 },
                style: {
                  fill: '#ffffff',
                  stroke: '#d9d9d9',
                  lineWidth: 1,
                  shadowColor: 'rgba(0,0,0,0.1)',
                  shadowBlur: 6
                }
              },
              {
                type: 'text',
                x: cardX + 12,
                y: cardY + cardH / 2,
                style: {
                  text: projectName,
                  // text: projectName && projectName.length > 8 ? projectName.slice(0, 8) + 'â€¦' : projectName || '',
                  textAlign: 'left',
                  textVerticalAlign: 'middle',
                  fill: '#333',
                  fontSize: 13,
                  fontWeight: 'bold'
                }
              },
              {
                type: 'circle',
                x: cardX + cardW - 12,
                y: cardY + 12,
                shape: { r: 7 },
                style: {
                  fill: statusColor,
                  stroke: '#fff',
                  lineWidth: 2,
                  shadowColor: 'rgba(0,0,0,0.2)',
                  shadowBlur: 2
                }
              },
              {
                type: 'text',
                x: descX,
                y: yCoord,
                style: {
                  text: description && description.length > 0 ? description : '',
                  textAlign: 'left',
                  textVerticalAlign: 'middle',
                  fill: '#666',
                  fontSize: 12,
                  // æœ€å¤§å®½åº¦é™åˆ¶ï¼Œè¶…å‡ºæ¢è¡Œ
                  width: maxDescWidth,
                  // æ”¯æŒè‡ªåŠ¨æ¢è¡Œ
                  overflow: 'break',
                  // å…è®¸æ˜¾ç¤ºå¤šè¡Œæ–‡å­—
                  lineHeight: 16
                }
              }
            ]
          }
        },
        z: 2
      }

      const option = {
        title: {
          text: 'é¡¹ç›®è¿›åº¦æ—¶é—´çº¿',
          left: 'center',
          top: 20,
          textStyle: {
            color: '#333',
            fontSize: 18,
            fontWeight: 'bold'
          }
        },
        grid: {
          left: 320,
          right: 100,
          top: 100,
          bottom: 100
        },
        xAxis: {
          type: 'time',
          position: 'top',
          min: '2025-01-01',
          max: '2025-12-31',
          splitNumber: 12,
          axisTick: { show: false },
          axisLine: { show: false },
          splitLine: { show: true },
          axisLabel: {
            show: false,
            formatter: '{MMM}'
          }
        },
        yAxis: {
          type: 'value',
          inverse: true,
          interval: 1, // ç¡®ä¿æ¯ä¸ªé¡¹ç›®æœ‰è¶³å¤Ÿç©ºé—´
          axisLabel: { show: false },
          axisTick: { show: false },
          axisLine: { show: false },
          splitLine: { show: false }
        },
        series: [projectStatusCardSeries, ...series]
      }

      myChart.setOption(option)

      // é‡è¦ï¼šçª—å£å¤§å°æ”¹å˜æ—¶é‡æ–°è®¡ç®—æ ‡ç­¾ä½ç½®
      window.addEventListener('resize', () => {
        myChart.resize()
      })
    </script>
  </body>
</html>
